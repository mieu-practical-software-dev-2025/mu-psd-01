# テスト仕様書: みんなの献立アドバイザー

## 1. テスト対象
- `app.py`（Flaskサーバー/APIバックエンド）
- `static/index.html`（フロントエンドUI）
- `static/main.js`（Vue.jsアプリケーションロジック）

## 2. テスト環境
- Windows 11
- Python 3.8以降
- Flask, openai, python-dotenv
- OpenRouter APIキー設定済み
- Webブラウザ: Chrome, Edge, Firefoxの最新版

## 3. テスト項目

### 3.1. サーバー起動・静的ファイル配信
| No | テスト内容 | 手順 | 期待結果 |
|----|------------|------|----------|
| 1  | サーバー起動 | コマンドプロンプトで `python app.py` を実行する。 | エラーなくサーバーが起動し、`* Running on http://127.0.0.1:5000` と表示される。 |
| 2  | 初期画面表示 | ブラウザで `http://localhost:5000/` にアクセスする。 | 「みんなの献立アドバイザー」のタイトルと入力フォームが表示される。Vueのテンプレート構文（`{{...}}`）が一瞬表示されたりしないこと。 |

### 3.2. `/generate_menu` API 正常系
| No | テスト内容 | 手順 | 期待結果 |
|----|------------|------|----------|
| 3  | 必須項目のみで献立生成 | 1. 食材に「鶏肉, 玉ねぎ」と入力する。2. 「献立を作成」ボタンをクリックする。 | 1. APIからステータスコード200でJSONデータが返却される。2. 画面に「① 今ある食材だけで作る献立」と「② 予算を使った献立」が表示される。 |
| 4  | 全項目を指定して献立生成 | 1. 食材、予算、嗜好の全フォームを入力する。2. 「献立を作成」ボタンをクリックする。 | 1. APIからステータスコード200でJSONデータが返却される。2. 入力内容を反映した献立が画面に表示される。3. レスポンスJSONに `shopping_list` と `seasonings_used` が含まれる。 |
| 5  | 予算なしで献立生成 | 1. 食材と嗜好のみ入力し、予算は空にする。2. 「献立を作成」ボタンをクリックする。 | 1. APIからステータスコード200でJSONデータが返却される。2. 「② 予算を使った献立」の `notes` に「予算内で追加できる献立はありません。」等のメッセージが表示される。 |

### 3.3. `/generate_menu` API 異常系
| No | テスト内容 | 手順 | 期待結果 |
|----|------------|------|----------|
| 6  | 食材未入力 | 1. 食材フォームを空のまま「献立を作成」ボタンをクリックする。 | 1. APIリクエストは送信されない。（フロントエンドで制御）2. (もし送信された場合) APIからステータスコード400とエラーメッセージ `{"error": "ingredients are required..."}` が返却され、画面にエラーが表示される。 |
| 7  | APIキー未設定 | 1. `.env` ファイルの `OPENROUTER_API_KEY` を空にする。2. サーバーを再起動し、献立生成を実行する。 | APIからステータスコード401 (Unauthorized) または関連するエラーが返却され、画面にエラーメッセージが表示される。 |
| 8  | AI応答がJSON形式でない | (要モック) AIからの応答がJSONではない不正な文字列だった場合。 | APIからステータスコード500とエラーメッセージ `{"error": "AI response was not valid JSON..."}` が返却され、画面にエラーが表示される。 |
| 9  | API通信エラー | (要モック) OpenRouter APIへのネットワーク接続が失敗した場合。 | APIからステータスコード503 (Service Unavailable) とエラーメッセージ `{"error": "Failed to connect to OpenRouter API..."}` が返却され、画面にエラーが表示される。 |

### 3.4. UIテスト
| No | テスト内容 | 手順 | 期待結果 |
|----|------------|------|----------|
| 10 | ローディング表示 | 「献立を作成」ボタンをクリックする。 | 1. ボタンが非活性（disabled）になる。2. ボタンのテキストが「作成中...」に変わる。 |
| 11 | 結果表示（正常系） | 献立生成が成功する。 | 1. ローディング表示が消える。2. ボタンが再度活性化する。3. 献立の結果が表示される。 |
| 12 | エラー表示（異常系） | 献立生成が失敗する（APIエラー等）。 | 1. ローディング表示が消える。2. ボタンが再度活性化する。3. 「エラー: ...」というメッセージが表示される。 |
| 13 | 買い物リスト表示 | 予算ありで献立を生成し、追加購入の提案があった場合。 | 「② 予算を使った献立」の下に、追加購入する食材の買い物リストが表示される。 |
| 14 | 調味料リスト表示 | 献立生成が成功した場合。 | 献立結果全体の下に、使用する調味料のリストが表示される。 |
| 15 | 買い物リストコピー機能 | 1. 買い物リストの「リストをコピー」ボタンをクリックする。2. テキストエディタなどにペーストする。 | 1. ボタンの表示が「コピーしました！」に変わる。2. クリップボードに買い物リストの内容がコピーされている。3. 約2秒後にボタンの表示が元に戻る。 |

## 4. その他
- 各入力フォームの最大文字数や入力可能な文字種に関するテストは、仕様が固まり次第追加する。
- 献立生成のレスポンス速度（体感）を計測する。

---
